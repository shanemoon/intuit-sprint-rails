<p id="notice"><%= notice %></p>

<div class= "show">
  <h2 style="text-align:center;position:absolute;width:inherit;">Song Info</h2>
  <div class= "show-heading">
  <%= link_to image_tag('home.png', :size=>'32x32'), root_path, :class=>"button"%>
  <%= link_to image_tag('close.png', :size=>'32x32'), @song, :class=>"button", :confirm => 'Are you sure?', :method => :delete %>
  </div>
<div class="icon">
  <%= image_tag(@song.avatar.url, :size=> "180x180") %>
  <p><b><%= @song.name %></b></p>
  <embed class="audio-player" src="<%=@song.autotuned.url%>"  autostart="false" loop="FALSE">
</div>

<div class="side">
<p>
  <b>Tempo:</b>
  <%= @song.tempo%>
<p>
  <b>Genre:</b>
  <%= @song.genre%>
<p>
  <b>Key:</b>
  <%= @song.key%>
<p>
  <b>Chord Progression:</b>
  <%= @song.chordProgression%>
<p>
  <b>Number of Phrases:</b>
  <%= @song.numPhrase%>
<p>
  <b>Midi:</b>
  <a href="<%=@song.midi.url%>">Download </a><br />
<p>
  <b>Melody:</b>
  <a href="<%=@song.melody.url%>">Download</a>
<p>
  <b>Vocal:</b>
  <a href="<%=@song.vocal.url%>">Download</a>
</p>
</div>
</div>
<br />


<div class="show">
  <h2 style="text-align:center;position:relative;width:inherit;">Notes</h2>
  <canvas id='sheet' width="440" height="250"></canvas>

  <script>

    var canvas = document.getElementById("sheet");
    var canvas_context = canvas.getContext("2d");
    var width = document.getElementById("sheet").offsetWidth;
    var height = document.getElementById("sheet").offsetHeight-5;
    <%  notes = []
        @song[:coords].split(',').each do |coord|
        notes << coord.to_i
        end
    %>
    var y_offset =  <%= notes.min%>;
    var y_scale = height/<%= notes.max%>;
    var x_length = (width)/ <%=notes.size%>;
    var x = 0;
    <% notes.each do |note|%>
      canvas_context.fillRect(x,height-(<%=note%>-y_offset)*y_scale,x_length,3)
      x += x_length;
    <%end%>
    canvas_context.strokeStyle = "#333";
    canvas_context.stroke();

    function draw_line(x_start,y_start,x_length,y_length){
        canvas_context.moveTo(x_start,y_start);
        canvas_context.lineTo(x_start+x_length,y_start);
    }
  </script>

</div>
